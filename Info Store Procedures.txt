Store Procedures de la app de chofer

-IniciarSesion: Inicia sesion: valida turno, vehiculo_conductores, usuario, contraseña, vehiculo y genera un registro en la tabla Conexiones
-CerrarSesion: Finaliza la conexion abierta (Tabla Conexiones)
-GuardarUbicacion: Guarda el estatus actual y estatus
-ActualizarSeguimiento: Actualiza la ubicacion y estatus en la tabla seguimientos
-GetEstatus: listado de estatus validos para actualizar (Libre, Ocupado, Ausente, Desconectado)
-GetChatBase: Regresa el arreglo de mensajes del chat con base
-EnviarChatBase: Envia un mensaje a la tabla de chat tipo base
-EnviarChatCliente: Envia un mensaje a la tabla de chat tipo cliente
-GetServicioActivo: regresa el despacho que tenga como estatus 4 ó 5 (despachado u ocupado)
-SetFechaDomicilio: guarda fecha_domicilio (el conductor ya se encuentra en el domicilio)
-SetServicioOcupado: guarda estatus_ocupado y fecha_ocupado (el cliente abordó la unidad)
-FinalizarServicio: guarda fecha_finalizacion, estatus finalizado, monto y observaciones
-GetServicesByVCId : historial y próximos servicios
-GetRazonesRechazo: listado de razones que la columna Activo=1



Inciar sesion, GetEstatus, GetRazonesRechazo: AccessView
GetServicioActivo, SetFechaDomicilio, SetServicioOcupado, FinalizarServicio: MapView
GetChatBase, EnviarChatBase: ChatView
CerrarSesion, GetServicesByVCId: Settings View
GuardarUbicacion, ActualizarSeguimiento: LeftView


============================================================================================================================================================


*Conexiones
- Cada vez que el conductor inicie sesión se guarda un registro en Conexiones: se guarda ID conductor, ID vehiculo, inicio y fin de sesión

*Ubicaciones y Seguimiento:

-Ubicaciones: guarda las coordenadas del vehiculo y estatus en ese momento, se guarda cada minuto (60seg) para obtener todo el historial:

SELECT u.Fecha_Ubicacion, u.Latitud, u.Longitud, e.Nombre as Estatus
FROM Ubicaciones u
INNER JOIN Conexiones c on c.ID_Conexion=u.ID_Conexion
INNER JOIN Estatus e on e.ID_Estatus=u.Estatus
WHERE c.ID_Vehiculo=@IDVEHICULO

-Seguimientos: Guarda la ultima coordenada, si tiene servicio activo guarda las coordenadas del servicio en Latitud_Origen, Longitud_Origen, Latitud_Destino, Longitud_Destino. Se actualiza cada 15seg

*Servicios

- Los estatus de la reserva se encuentran en la tabla Estatus_Reserva, al chofer le aparecerá en la pantalla de Mapa cuando la reserva tenga el estatus de 4 (Asignado) ó 5 (Ocupado): se obtiene del procedure GetServicioActivo
- Servicios Próximos: las reservas ligadas a un despacho que tengan el estatus_reserva= 2: Se obtienen del procedure GetServicesByVCId
- Historial de servicios: las reservas con estatus 6 ó 7 (Cancelado, Finalizado): Se obtienen del procedure GetServicesByVCId